<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">

      #states path {
        fill: #ccc;
        stroke: #fff;
      }

      path.arc {
        pointer-events: none;
        fill: none;
        stroke: #000;
        display: none;
      }

      path.cell {
        fill: none;
        pointer-events: all;
      }

      circle {
        fill: steelblue;
        fill-opacity: .8;
        stroke: #fff;
      }

      #cells.voronoi path.cell {
        stroke: brown;
      }

      #cells g:hover path.arc {
        display: inherit;
      }

    </style>
  </head>
  <body>
    <h2>
    </h2>
    <script type="text/javascript" src="d3.v2.min.js"></script>
    <script type="text/javascript">

      var w = 1280,
      h = 800;

var projection = d3.geo.azimuthal()
  .mode("orthographic")
  .origin([-80, 30])
.scale(400)
  .translate([640, 360]);

var circle = d3.geo.greatCircle()
.origin([-80, 30])
  ;


//mercator has issues with wrapping around globe
//var projection = d3.geo.mercator()
  //.scale(1000)
  //;

var path = d3.geo.path()
  .projection(projection);

  function draw(d) {
    return path(circle.clip(d));
  }


  var svg = d3.select("body").insert("svg:svg", "h2")
  .attr("width", w)
  .attr("height", h);

  var states = svg.append("svg:g")
  .attr("id", "states");

  var circles = svg.append("svg:g")
  .attr("id", "circles");

  var cells = svg.append("svg:g")
  .attr("id", "cells");

  var arcs = svg.append("g")
    .attr("id", "arcs");

  var color_range = d3.interpolateRgb("blue", "green");
  //var color_range = d3.scale.category20();

  var country_fill = function(d) {
    lettervalue = ((d.id.charCodeAt(0)-65)/26) * 20; // take first letter of country code, convert to category20 range of [1,20]
    lettervalue = ((d.id.charCodeAt(0)-65)/26);  //use with interpolateRgb range of [0,1]
    return color_range(lettervalue);
  }


  d3.json("d3/world-countries.json", function(collection) {
      states.selectAll("path")
      .data(collection.features)
      .enter().append("svg:path")
      .attr("d", draw)
      //.style("fill", "SteelBlue")
      .style("fill", country_fill)
      ;
      });

var arc = d3.geo.greatArc()
  .precision(1);

var nodes = []

var source_x = function(d) {
  node = nodes[d.source];
  return projection([node.Longitude, node.Latitude])[0];
}
var source_y = function(d) {
  node = nodes[d.source];
  return projection([node.Longitude, node.Latitude])[1];
}

var target_x = function(d) {
  node = nodes[d.target];
  return projection([node.Longitude, node.Latitude])[0];
}

var target_y = function(d) {
  node = nodes[d.target];
  return projection([node.Longitude, node.Latitude])[1];
}

var arc_coords = function(d) {
  source = nodes[d.source];
  target = nodes[d.target];
  var retval =  {
    'source': [source.Longitude, source.Latitude],
    'target': [target.Longitude, target.Latitude]
  };
  return retval;
}




d3.json("files/Internode.json", function(network) {
    nodes = network.nodes;

    arcs.selectAll("path")
    .data(network.links)
    .enter().append("path")
    .style("stroke-width", 2)
    .style("stroke", "orange")
    .style("fill", "none")
    .attr("d", function(d) { return draw(arc(arc_coords(d))); });

    //var line = svg.selectAll("line")
    //.data(network.links)

    //TODO: see why edge_id changes sometimes even though appears the same

    //line.enter().append("line")
    //.style("stroke", "gray");

    //line 
    //.attr("x1", source_x)
    //.attr("y1", source_y)
    //.attr("x2", target_x)
    //.attr("y2", target_y)

    circles.selectAll("circle")
    .data(network.nodes)
    .enter().append("svg:circle")
    .attr("d", draw)
    .attr("cx", function(d) { return projection([d.Longitude, d.Latitude])[0]; })
    .attr("cy", function(d) { return projection([d.Longitude, d.Latitude])[1]; })
    .attr("r", 3) ;

})

</script>
  </body>
</html>
